# 要件定義書 - Habit Penguin (ハビペン)

| 項目 | 内容 |
| --- | --- |
| プロジェクト名 | Habit Penguin (ハビペン) |
| バージョン | 1.1 (Final Fix) |
| パッケージ名 | com.habitpenguin.app |
| プラットフォーム | iOS先行 (Flutter) |
| 対応言語 | 日本語のみ |
| ターゲット | カップル、家族、シェアハウス（最大5名） |

## 1. プロダクト概要

### 1.1 コンセプト
「タスク管理」×「育成ゲーム」。
日々の家事や雑務（タスク）を共有・消化することで、グループの共有ペットである「ペンギン」を育て、着せ替えを楽しむ癒やし系アプリ。

### 1.2 コアバリュー
*   **事務的作業のエンタメ化:** 「やらなきゃ」を「ペンギンのために」に変換する。
*   **摩擦のない共有:** 言った言わない、やったやってないをログで解決しつつ、ペンギンが代弁することで角を立てない。
*   **個人の資産化:** グループが変わっても、収集したスキンやポイントは個人の持ち物として残る。

## 2. 機能要件 (Functional Requirements)

### 2.1 ユーザー & グループ管理
*   **認証方式:**
    *   Google Sign-In / Sign in with Apple
    *   ゲストログイン（匿名認証）
*   **アカウント連携:** ゲスト利用後のアカウント昇格（設定画面から連携）を実装。
*   **プロフィール:**
    *   ニックネーム: 初回起動時に必須入力。
    *   アイコン: 画像アップロードはなし。イニシャルと色で自動生成（ストレージコスト削減・リスク回避）。
*   **グループ仕様:**
    *   人数上限: 最大5名。
    *   招待方法:
        1.  Deep Link (Webクッションページ経由) での自動参加。
        2.  招待ID（文字列）の手動入力による参加。
    *   合流時の挙動 (重要): 既に個人でタスクを持っているユーザーが既存グループに参加する場合、**現在の未完了タスクはリセット（破棄）**される。「タスクリストがリセットされますがよろしいですか？」と警告ダイアログを表示する。
    *   追放（Kick）: 機能なし（トラブル防止）。自発的な「退出」のみ。
    *   解散: メンバーが0人になった時点で論理的に消滅（データは残る）。

### 2.2 タスク管理機能
*   **一覧表示 (Tab 2):**
    *   ソート順: 期限切れ(昇順) > 今日・明日(昇順) > 未来 > 期限なし(作成日降順)。
    *   件数制限: 1グループあたり未完了タスク 最大100件。
*   **初期データ (Seed Data):**
    *   アプリ初回起動時、操作学習用のチュートリアルタスク（例：「パートナーを招待しよう」「このタスクを完了させてみよう」など）を自動生成する。
*   **タスク属性:**
    *   タイトル、詳細メモ。
    *   カテゴリ: プリセットアイコンを選択 ＋ ユーザー定義の名前。
    *   期限: 日付のみ（時間指定なし）。
    *   担当者: 任意（「未定」許容）。
    *   繰り返し: 毎日/毎週/毎月（作成時に設定）。
        *   ■ ロジック: 完了した瞬間に、設定に基づき次回分のタスクを自動生成。
*   **操作:**
    *   完了: リストを右スワイプ（効果音・振動あり）。
    *   削除: リストを左スワイプ。
*   **通知・リマインド:**
    *   対象: 全員ではなく**「作成者」と「担当者」のみ**に通知。
    *   リマインド: 期限当日の朝 8:00 (JST/端末時間) に最大2件まで通知。
    *   催促: 相手が未完了の場合、ボタン一つで「ペンギンが様子を見ています」と通知（連打防止クールタイムあり）。

### 2.3 育成・ホーム画面 (Tab 1)
*   **ペンギン表示:**
    *   グループメンバー全員分（最大5匹）のペンギンを表示。
    *   感情ロジック: 未完了タスクの「期限切れ」または「期限当日」がある場合のみ、焦る・泣く等のリアクション。通常時は寝ている・くつろいでいる。
    *   インタラクション: タップでランダムなセリフを喋る（吹き出し）。
*   **スキン反映:**
    *   各ユーザーが設定しているスキン（帽子・服など）をリアルタイム反映。

### 2.4 経済・ガチャシステム (Tab 3)
*   **ポイント獲得:**
    *   タスク完了: +5pt。
    *   デイリーキャップ: 1人1日 30pt まで。
    *   リワード広告視聴: 別途ポイント付与（救済措置）。
*   **ガチャ仕様:**
    *   価格: 1回 100pt。
    *   トランザクション: Cloud Functionsによるサーバーサイド処理（通信断対策）。オフライン時は実行不可。
    *   被り救済: 既所持アイテムが出た場合、**「チケット」**に変換。
    *   天井: チケット5枚で好きなスキンと交換可能。

### 2.5 設定・その他
*   **設定項目:**
    *   サウンド設定（SE/バイブレーションのON/OFF）。
    *   通知設定。
    *   アカウント連携 / 退会。
    *   ライセンス表記 / 問い合わせ（Googleフォーム）。
    *   購入の復元。
    *   レビュー依頼: 累積10タスク完了時にポップアップ表示。

## 3. 非機能要件 (Non-Functional Requirements)

### 3.1 インフラ・アーキテクチャ
*   **Backend:** Firebase (Auth, Firestore, Functions, Remote Config).
*   **Database:** Cloud Firestore.
*   **IAP (課金):** RevenueCat を採用。

### 3.2 運用・保守・制限
*   **データライフサイクル:**
    *   完了タスク履歴: 3ヶ月（90日）経過後に自動削除（Batch処理）。
    *   退会処理: 即時削除ではなく30日間の削除予約（論理削除）。期間内の再ログインで復旧可能。
*   **強制アップデート:** Remote Configにより、必須バージョン未満のアプリを起動ロックする機能を実装。
*   **メンテナンスモード:** 緊急時にアプリ操作を全停止し、メンテ画面を表示するスイッチを実装。
*   **オフライン対応:**
    *   タスク閲覧・追加・完了：可能（ローカルキャッシュ＆再接続時同期）。
    *   ガチャ・課金・広告：不可（エラー表示またはグレーアウト）。

### 3.3 UI/UX・デザイン
*   **デザイン:** 癒やし系（丸みを帯びたUI）。
*   **ダークモード:** 非対応（ライトモード固定）。
*   **タイムゾーン:** ユーザーの端末設定依存（遠距離対応）。

## 4. マネタイズ (Monetization)

| 種類 | 内容 | 実装箇所 |
| --- | --- | --- |
| 広告非表示プラン | ¥480 (買い切り/非消費型)。購入後は全ての広告を排除。 | RevenueCat |
| バナー広告 | 画面下部に常駐。 | AdMob |
| 動画リワード広告 | 視聴でポイント獲得（ガチャ不足分を補う）。 | AdMob |

## 5. ストア・法的要件 (Store & Legal)

| 項目 | 詳細 |
| --- | --- |
| アプリ名 | ハビペン (Habit Penguin) |
| カテゴリ | ライフスタイル / 仕事効率化 |
| プライバシーポリシー | 招待用Webクッションページの下部にリンク設置。 |
| 利用規約 (EULA) | 初回起動時に同意画面を表示。 |
| アカウント削除 | アプリ内設定画面から実行可能（Appleガイドライン準拠）。 |
| スクリーンショット | 別途作成（エンジニアお任せではなく、デザイナー加工）。 |